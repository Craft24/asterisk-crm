
====================================================================================

      asterCRM  (C) 2006,2007  Solo Fu  solo@magiclink.cn solo.fu@gmail.com

====================================================================================

asterCRM is a AJAX based 'Call Center' system. 

First, Asterisk Events are captured as the occur via a perl script called eventsdaemon and
logged to a MySQl database table.
Since Asterisk is sending these events as they occur (and not being polled for these events),
this leads to a more efficient Asterisk interface.

eventsdaemon.pl is a perl script which connects to AMI (the Asterisk Manager
Interface) via a stock, listens for any events or messages coming from
the AMI, time stamps each event and logs them to a MySQL database table.

eventsdaemon can be run on any machine and not confined running in your Asterisk server,
More information on the function of eventsdaemon can be found in its source comments.

WEB PHP scripts will analyze Asterisk Events in database, and finish call center jobs, 
such as pop-up, click to dial, call queue ... 

asterCRM scripts require a running WEB and MySQL server (in which stored asterisk events). All of these 
processes can run on the same server, however, multiple servers enhance performance.

1. Features

	1) pop-up when incoming calls 

	2) pop-up when outbound calls

	3) suggestion when enter business name or contact 

	4) account/extension manager

	5) click to dial

	6) click to transfer

	7) can be integrated with all asterisk based systems, 
			such as Magiclink IP PBX, Trixbox ...
	
	8)	multi-language support (Chinese and English for now)

	9)	support external crm

	10)	extension status

	11) show asterisk active channels 

	12) predictive dialer

	13) CRM data import/export

	14) dial manually in agent interface 

	15) survey

	16) monitor control


2. asterCRM Installation: (assuming your WEB root is /var/www/html)

1) Download and unzip the source

	cd /var/www/html
	unzip astercrm-X.X-XXXX.zip

	Note: this creates the /var/www/html/astercrm directory which contains the
	PHP scripts and several sub-directories. 

	/var/www/html/astercrm						main directory and PHP scripts  
	/var/www/html/astercrm/eventsdaemon 		eventsdaemon file
	/var/www/html/astercrm/includes 			files needed in php scripts
	/var/www/html/astercrm/includes/language 	asterCRM language files
	/var/www/html/astercrm/images				image files used via the PHP scripts
	/var/www/html/astercrm/css					style files used via the PHP scripts
	/var/www/html/astercrm/js					auto-complete java scripts
	/var/www/html/astercrm/upload				
	/var/www/html/astercrm/cdr					Asterisk-stat				
	/var/www/html/astercrm/sql					sql to create astercrm database 

	It is highly advised that the whole proxyman directory be moved to a more secure
	location like /opt and out of the WEB root directory (see step 4)

2) Create the MySQL database and table, asterCRM need mysql 4.1 or above

	mysqladmin create asterisk
	mysql </var/www/html/astercrm/sql/astercrm.sql

	Note: the astercrm.sql file has the GRANT commands to update MySQL with
		the desired authority. The settings here must match the userid/password
		specified in the ProxyMan.py , delete_events.py script and the config.php script
		you can modify this script to meet your database

	Update the /var/www/html/astercrm/config.php script for the
	correct MySQL login userid/password 
	Make sure it matches what was specified in the astercrm.sql
	(user: asteriskuser password: asterisk by default)
	Asterisk Manager login username/password. 
	Make sure it matches what was specified in the manager.conf file.

	Update the /var/www/html/astercrm/eventsdaemon/eventsdaemon.pl script for the correct MySQL
	login userid/password. Make sure it matches what was specified in the
	astercrm.sql file. ProxMan.py also needs updated with the Asterisk Manager
	password and secret (password), documented in the next step.
	The proxyman.py script has comments in the source noting the variable names
	and their functions.

3) Update /etc/asterisk/manager.conf to enable Manager connections
	Note: asterisk and astercrm could be on different server
 
	Add something like this to the manager.conf file:

	[general]
	enabled = yes
	port = 5038
	bindaddr = 0.0.0.0
	;displayconnects = yes

	;the following line could be changed by your selft
	[eventmanager]
	secret = asterisksecret
	read = system,call,log,verbose,command,agent,user
	write = system,call,log,verbose,command,agent,user

	Note: the manager.conf settings for user ([eventmanager] in this example)
		and secret need to match the /var/www/html/ProxyMan.py variable settings.
		The ProxyMan.py script has comments in the source noting the variable
		names and their functions.

4) Create the directories and move proxyman scripts:

	mkdir /opt/asterisk
	mkdir /opt/asterisk/scripts
	mkdir /opt/asterisk/scripts/events
	mv /var/www/html/events/eventsdaemon/* /opt/asterisk/scripts/events
	chmod +x /opt/asterisk/scripts/events/eventsdaemon.pl

5) Start Asterisk and  eventsdaemon.pl


	Start eventsdaemon (default settings):
		/opt/asterisk/scripts/events/eventsdaemon.pl &

	OR Start eventsdaemon (debug settings):

		/opt/asterisk/scripts/events/eventsdaemon.pl debug 

	At some point it may be desirable to delete unwanted events from the database
	table. The eventsdaemon is also designed for this.
	please check eventsdaemon.pl for parameter "log_life"

6) modify astercrm.conf.php to fit your configration

7) set upload folder access to 777

	chmod 777 /var/www/html/astercrm/upload

8) Testing: browse to http://localhost/astercrm

	or http://YOUR-WEB-SERVER-ADDRESS/astercrm
		
	login with admin/admin

9) Manager interface
   
	click "Manager" on top right, then

	click "Extension Manager" to setup extension username and password

	click "System Monitor" to monitor system status

	click "Active Channels" to monitor active channels in asterisk

	click "Predictive Dialer" to enter predictive dialer section

	click "Customer Manager" to enter customer information management section

	click "Contact Manager" to enter contact information management section

	click "Note Manager" to enter note information management section

	click "Back" to return to agent interface

3. How to use confirm button

	Customer field support auto-complete, which means it will list all items in 
	customer database matched with your entered. if you find the customer  already exsited, 
	select the item and then click "confirm" button, then all information for the customer 
	will be filled automaticly. (screenshot/1,2,3) Click "Cancel" button will clear all 
	information, you can enter another customer .

	Contact field is almost same with customer field, but it only list contacts belongs 
	to the customer above.

====================================================================================

2007-10-9	Version 0.445 Released (GPL)
2007-10-22	Version 0.45  Released (GPL)

====================================================================================

       The author can be reached at solo.fu@gmail.com for comments and suggestions.

====================================================================================

Manager Interface 

1. Extension Manager

Binding astercrm account and asterisk extension here, 
also manager could grant privileges to astercrm account.

username:		username to log into astercrm
password:		password to log into astercrm
usertype:		only two levels for now. 
				If it's "admin" in this field, 
				which means this account could enter manager interface section.
extension:		a extension would be binding to this user,
				which means all events of the extension would reflect this user
				such as dial, hangup, also pop-up
				digits only 
				(e.g. 8000)
extensions:		which extensions the user could see status, and use click to transfer
				put several extensions here, use comma to seperate
				(e.g. 8000,8001,8002,8003)

2. System Monitor

	You could see sip peer status here, 
	such as which peer is calling, 
		    which peer is online or offline

	Notice:
		some peer may not appear here, because system monitor read data from database
		so usually we can not read all sip peer status here

3. Active Channels

	this page shows the result of cli command:
		sip show channels verbose
	the result refresh every one second.

4. Predictive Dialer

Administrator could upload a phone list to table "diallist", so that astercrm know 
which number could be dialed.
there's are two field in table "diallist"
	phonenumber and assign
About assign, it would be a extension number in this field, means this number could be dialed by which extension, 
this phone number would appears in "agent dial mode"

there're two mode in dialer setion:

	a. agent dial mode

if phone number is assigned to extension in table "dial list", when agent login, 
he could see a button "get a new number" and XX records in dial list, 
then he can dial the button, a new table would pop up,
and in this table would have a phone number, agent could click the number to make a call. 
once agent click the button and a new table pop up with a new phone number, 
the number would be
deleted from database, so agent could see that the number in dial list would decrease, 
until no records in database, and the button disappears.

	b. manager predial mode

manager dial mode need a "admim" user, in predictive dialer module, 
if there're records in table "diallist"
(whatever assigned or not), he could see XXX records (means records number in database), 
a "Dial" button and a inputbox (means maximum concurrent active channel in asterisk, 
it would "pause" when asterisk active channels reach this number untill some channels 
hang up dialer would "continue" automaticly), during
this progress manger could stop/start the dialer or change max channels number. 
In config.php you could set where the call would be sent to when answered, 
such as a IVR, a queue or whatever you need.


5. Customer Manager

6. Contact Manager

7. Note Manager
