
====================================================================================

      AsterCRM Lite (C) 2006,2007  Solo Fu  solo@magiclink.cn solo.fu@gmail.com

====================================================================================

The AsterCRM Lite is a WEB/AJAX based 'Call Center' system. 

First, Asterisk Events are captured as the occur via a python script called ProxyMan.py and logged to a MySQl database table(using script from Asterisk Event Monitor by earl@micpc.com). Since Asterisk is sending these events as they occur (and not being polled for these events), this leads to a more efficient Asterisk interface.

ProxyMan.py is a Python script which connects to the Asterisk Manager
Interface via a TCP/IP connection, listens for any events or messages coming from
the Manager Interface, time stamps each event and logs them to a MySQL database table.

ProxyMan can be run on any machine with a TCP/IP connection to the Asterisk server,
i.e. it does not have to run on the same machine as Asterisk.
More information on the function of ProxyMan can be found in its source comments.

WEB PHP scripts will analyze Asterisk Events in database, and finish call center jobs, such as pop-up, click to dial, call queue ... 

The AsterCRM Lite scripts require a running WEB and MySQL server. All of these 
processes can run on the same server, however, multiple servers enhance performance.

AsterCRM Lite Installation: (assuming your WEB root is /var/www/html)

1) Download and untar the source

     cd /var/www/html
     wget http://www.magiclink.cn/astercrm/astercrm.tar.gz
     tar -xzvf astercrm.tar.gz

     Note: this creates the /var/www/html/events directory which contains the
     PHP scripts and several sub-directories. 

        /var/www/html/astercrm			main directory and PHP scripts  
	/var/www/html/astercrm/proxyman 	proxyman related files
	/var/www/html/astercrm/includes 	files needed via the PHP scripts, also xajax and xajaxGrid
	/var/www/html/astercrm/images		image files used via the PHP scripts
	/var/www/html/astercrm/css		style files used via the PHP scripts

     It is highly advised that the whole proxyman directory be moved to a more secure
     location like /opt and out of the WEB root directory (see step 4)

2) Create the MySQL database and table

      mysqladmin create asterisk
      mysql </var/www/html/astercrm.sql

   Note: the astercrm.sql file has the GRANT commands to update MySQL with
         the desired authority. The settings here must match the userid/password
         specified in the ProxyMan.py script and the includes/db_connect.php script

   Update the /var/www/html/astercrm/config.php script for the
   correct MySQL login userid/password. Asterisk Manager login username/password. Make sure it matches what was specified
   in the astercrm.sql and manager.conf file.

   Update the /var/www/html/proxyman/ProxyMan.py script for the correct MySQL
   login userid/password. Make sure it matches what was specified in the
   astercrm.sql file. ProxMan.py also needs updated with the Asterisk Manager
   password and secret (password), documented in the next step.
   The proxyman.py script has comments in the source noting the variable names
   and their functions.

3) Update /etc/asterisk/manager.conf to enable Manager connections
 
       Add something like this to the manager.conf file:

	[general]
	enabled = yes
	port = 5038
	bindaddr = 0.0.0.0
	;displayconnects = yes

	[eventmanager]
	secret = asterisksecret
	read = system,call,log,verbose,command,agent,user
	write = system,call,log,verbose,command,agent,user

   Note: the manager.conf settings for user ([eventmanager] in this example)
	 and secret need to match the /var/www/html/ProxyMan.py variable settings.
	 The ProxyMan.py script has comments in the source noting the variable
	 names and their functions.

4) Create the directories and move the scripts:

        mkdir /opt/asterisk
        mkdir /opt/asterisk/scripts
        mkdir /opt/asterisk/scripts/events
	mv /var/www/html/events/proxyman/* /opt/asterisk/scripts/events

5) Start Asterisk and  ProxyMan.py

   Start ProxyMan (default settings):

	/opt/asterisk/scripts/events/ProxyMan.py 

   OR Start ProxyMan (change settings):

        /opt/asterisk/scripts/events/ProxyMan.py debug 

   Note: when ProxyMan.py starts it will automatically become a daemon
         (so no need for for the & at the end of the command)
         
   Another python script is provided (asterstart.py) which can also be used to start
   Asterisk and ProxyMan.py and keep them running. See the README in the proxyman 
   directory.
 
   At some point it may be desirable to delete unwanted events from the database
   table. The Python script delete_events.py is designed for this.
   If run from a CRON task:

      1   0   * * * /opt/asterisk/scripts/events/delete_events.py >/dev/null 2>&1

   It will delete all events older than the current date (as of midnight
   the previous day).

6) This step is only needed to allow Manager Functions.

   If the web server is not the same server that Asterisk is running on, for
   the manager commands to work, the file

       /var/www/html/events/includes/manager_login.php

   needs customized. It will by default, try to open the

       /etc/asterisk/manager.conf

   file and get the user and secret from there to  use for Manager Login. 
   Update it with the correct IP address, manager id and password to make the TCP/IP
   connection to a different server and delete the code that tries to open the
   /etc/asterisk/manager.conf file. Edit the file and look at the comments for
   more information on this.

   This customization is also necessary for the "Queues" option to work. The queues.php
   code invokes Manager commands to display the Agent and Queue Information. It does not
   obtain it from the event records.

7) Basic Config: http://localhost/astercrm/manager.php
   
	        or http://YOUR-WEB-SERVER-ADDRESS/astercrm

	to set username/password for extensions

7) Testing: browse to http://localhost/astercrm

	        or http://YOUR-WEB-SERVER-ADDRESS/astercrm


====================================================================================

2007-08-7	Version 0.01 Released (GPL)

====================================================================================

       The author can be reached at solo.fu@gmail.com for comments and suggestions.

====================================================================================
